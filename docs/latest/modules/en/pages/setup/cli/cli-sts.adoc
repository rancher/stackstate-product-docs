= CLI: sts
:revdate: 2025-07-29
:page-revdate: {revdate}
:description: {stackstate-product-name}

== Overview

The {stackstate-product-name} `sts` CLI provides easy access to the functionality provided by the {stackstate-product-name} APIs. It can be used for automation using {stackstate-product-name} data, to configure {stackstate-product-name} and to develop StackPacks.

== Prerequisites

* **{stackstate-product-name} URL** - The URL of your {stackstate-product-name} instance (the same URL used to access the web interface).
* **API Token** - A valid API token for authentication, which can be retrieved from the *CLI* page in your {stackstate-product-name} instance.

To obtain your API token:

. Log into your {stackstate-product-name} instance.
. Navigate to *Main menu* > *CLI*.
. Copy the API token displayed on the page.

== Quick start

The fastest way to install and configure the `sts` CLI is to use the pre-filled commands available in your {stackstate-product-name} instance:

. Log into your {stackstate-product-name} instance.
. Navigate to *Main menu* > *CLI*.
. Copy the command for your OS and run it in a terminal.

These commands are pre-filled with the correct URL and API token for your specific {stackstate-product-name} instance, making installation and configuration a single step.

== Download the CLI

[tabs]
====
Windows::
+
--
Open a *Powershell* terminal (version 5.1 or later) and run the steps below. This can be done one step at a time, or joined together as a single script. After installation, the `sts` command will be available for the current user on both the Powershell terminal and the command prompt (cmd.exe).

. Set the source version and target path for the CLI:
+
[,powershell]
----
$CLI_PATH = $env:USERPROFILE +"\stackstate-cli"
If (!(test-path $CLI_PATH)) { md $CLI_PATH }
Invoke-WebRequest https://dl.stackstate.com/stackstate-cli/LATEST_VERSION -OutFile $CLI_PATH\VERSION
$VERSION=type $CLI_PATH\VERSION
$VERSION=$VERSION -replace "[v]"
$CLI_DL = "https://dl.stackstate.com/stackstate-cli/v$VERSION/stackstate-cli-$VERSION.windows-x86_64.zip"
echo "Installing {stackstate-product-name} CLI v$VERSION to: $CLI_PATH"
----

. Download and unpack the CLI to the target CLI path. Remove remaining artifacts:
+
[,powershell]
----
Invoke-WebRequest $CLI_DL -OutFile $CLI_PATH\stackstate-cli.zip
Expand-Archive -Path "$CLI_PATH\stackstate-cli.zip" -DestinationPath $CLI_PATH -Force
rm $CLI_PATH\stackstate-cli.zip, $CLI_PATH\VERSION
----

. Register the CLI path to the current user's PATH. This will make the `sts` command available everywhere:
+
[,powershell]
----
$PATH = (Get-ItemProperty -Path "Registry::HKEY_CURRENT_USER\Environment" -Name PATH).Path
if ( $PATH -notlike "*$CLI_PATH*" ) {
  $PATH = "$PATH;$CLI_PATH"
  (Set-ItemProperty -Path "Registry::HKEY_CURRENT_USER\Environment" -Name PATH –Value $PATH)
  $MACHINE_PATH = (Get-ItemProperty -Path "Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment" -Name PATH).path
  $env:Path = "$PATH;$MACHINE_PATH"
}
----

. Verify that the CLI works:
+
[,powershell]
----
sts version
----
--

macOS::
+
--
Open a terminal and run the steps below. This can be done one step at a time, or all together as a single script. After installation, the `sts` command will be available for the current user.

. Download the latest CLI version for x86_64 (Intel) or arm64 (M1).
+
[,bash]
----
(VERSION=`curl https://dl.stackstate.com/stackstate-cli/LATEST_VERSION` &&
  VERSION=${VERSION#v} &&
  ARCH=`uname -m` &&
  curl https://dl.stackstate.com/stackstate-cli/v$VERSION/stackstate-cli-$VERSION.darwin-$ARCH.tar.gz | tar xz --directory /usr/local/bin)
----

. Verify that the CLI works:
+
[,bash]
----
sts version
----
--

Linux::
+
--
Open a terminal and run the steps below. This can be done one step at a time, or all together as a single script. After installation, the `sts` command will be available for the current user.

. Download and unpack the latest version for x86_64:
+
[,bash]
----
(VERSION=`curl https://dl.stackstate.com/stackstate-cli/LATEST_VERSION` && VERSION=${VERSION#v} &&
curl https://dl.stackstate.com/stackstate-cli/v$VERSION/stackstate-cli-$VERSION.linux-x86_64.tar.gz | tar xz --directory /usr/local/bin)
----

. Verify that the CLI works:
+
[,bash]
----
sts version
----
--

Docker::
+
--
To run the latest version of the CLI using Docker execute:

[,bash]
----
docker run stackstate/stackstate-cli2
----

Alternatively, go to the *CLI* page in the {stackstate-product-name} UI and copy the *Quick installation* command for *Docker* - this is pre-filled with the correct `<URL>` and `<API-TOKEN>` required to configure the CLI for your {stackstate-product-name} instance.

You can now run CLI commands by appending them to the end of the `docker run` command (for example, `docker run stackstate/stackstate-cli2 version`).
--
====

== Configure the CLI

=== Authentication

==== API token

By default, the CLI will authenticate using the API token that you provided when the CLI configuration was saved.

[CAUTION]
====
The most secure way to use your API token is through an environment variable. You can store the API token with a secrets manager and inject it as an environment variable into your shell.
====

[tabs]
====
Windows / macOS / Linux::
+
--
. In the {stackstate-product-name} UI, go to *Main menu* > *CLI* and copy your API token.
. Run the command below, where `<URL>` is the URL to your {stackstate-product-name} instance and `<API-TOKEN>` is the API token you copied from the CLI page in the {stackstate-product-name} UI:
+
[,bash]
----
sts context save --name <NAME> --url <URL> --api-token <API-TOKEN>
----

. The connection to your {stackstate-product-name} instance will be tested and a configuration file stored at `~/.config/stackstate-cli/config.yaml`.
--

Docker::
+
--
The Docker version of the CLI can't be configured with a config file. Specify the configuration of your {stackstate-product-name} instance using environment variables and pass these to Docker:

* `STS_CLI_URL` - the URL to your {stackstate-product-name} instance.
* `STS_CLI_API_TOKEN` - the API token taken from the {stackstate-product-name} UI *Main menu* > *CLI* page.
* `STS_CA_CERT_PATH` - path to a PEM-encoded CA certificate file for servers using self-signed certificates. The directory containing the certificate must be mounted into the Docker container.
* `STS_CA_CERT_BASE64_DATA` - base64-encoded CA certificate data for servers using self-signed certificates (ignored if `STS_CA_CERT_PATH` is specified).
* `STS_SKIP_SSL` - disables SSL certificate validation (ignores certificate configurations, use with caution).

For example:

[,bash]
----
docker run \
   -v /path/to/certs:/certs \
   -e STS_CLI_URL \
   -e STS_CLI_API_TOKEN \
   -e STS_CA_CERT_PATH=/certs/ca.crt \
   stackstate/stackstate-cli2 settings list --type Layer
----
--
====

==== Service tokens

You can optionally use the CLI to create one or more service tokens to authenticate with the {stackstate-product-name} Base and Admin APIs. For example, a service token can be used to authenticate in CI (Continuous Integration) scenarios where no real user is doing the operations on the {stackstate-product-name} instance.

To create a service token, run the command below:

[,bash]
----
sts service-token create --name <NAME> --roles <ROLE(s)> [--expiration <yyyy-MM-dd>]
----

This will create a new service token and print it. The `--expiration` parameter is optional and can be used to set the expiration date of the service token.

Once you have this, you can configure the CLI to use it:

[,bash]
----
sts context save --name <NAME> --service-token <TOKEN> --url <URL>
----

=== Manage multiple contexts

The `sts` CLI supports configuration and management of different (authentication) contexts. This enables you to easily switch between an administrative and regular user, or to switch between different {stackstate-product-name} instances. For example, you could use a different context for a test and production instance of {stackstate-product-name}. You can list, save, delete, set and validate contexts in the `sts` CLI. Run `sts context -h` for details of the available commands and their usage.

=== Configuration options

You don't need a configuration file to run the `sts` CLI. You can also configure the CLI through a combination of environment variables and flags.

If multiple types of configuration are presented to the CLI the order of processing will be:

. Flags
. Environment variables
. Config file

|===
| Environment variable | Flag | Description

| `STS_CLI_URL`
| `--url`
| URL to your {stackstate-product-name} instance.

| `STS_CLI_API_TOKEN`
| `--api-token`
| API token to your {stackstate-product-name} instance. The most secure way to use your API token is through an environment variable. You can store the API token with a secrets manager and inject it as an environment variable into your shell.

| `STS_CLI_SERVICE_TOKEN`
| `--service-token`
| A service token to your {stackstate-product-name} instance. The most secure way to use your service token is through an environment variable. You can store the service token with a secrets manager and inject it as an environment variable into your shell.

| `STS_CA_CERT_PATH`
| `--ca-cert-path`
| Path to a PEM-encoded CA certificate file for servers using self-signed certificates or certificates from a private CA.

| `STS_CA_CERT_BASE64_DATA`
| `--ca-cert-base64-data`
| Base64-encoded CA certificate data for servers using self-signed certificates or certificates from a private CA. Ignored if `STS_CA_CERT_PATH` is specified.

| `STS_SKIP_SSL`
| `--skip-ssl`
| Disables SSL certificate validation. When set to `true`, the CLI will not validate SSL certificates and will ignore `STS_CA_CERT_PATH` and `STS_CA_CERT_BASE64_DATA` settings. Use with caution as this reduces security.

| `STS_CLI_API_PATH`
| n/a
| The path appended to the end of the URL to get the API endpoint. (Defaults to `/api`)

| `STS_CLI_CONTEXT`
| `--context`
| The name of the context to use.
|===

Next to overriding specific parts of the config file, it's also possible to override the default config file location. This is done through the `--config <PATH>` flag.

== Available Commands

The `sts` CLI provides the following top-level commands:

|===
| Command | Description

| agent
| Manage {stackstate-product-name} agents

| completion
| Generate autocompletion scripts for shells

| context
| Manage the CLI contexts and configurations

| dashboard
| Manage dashboards

| health
| Health synchronization related commands

| license
| Manage {stackstate-product-name} license information

| monitor
| Manage monitors and monitoring configurations

ifdef::ss-ff-stackpacks2_enabled[]
| otel-component-mapping*
| Manage OpenTelemetry component mappings

| otel-relation-mapping*
| Manage OpenTelemetry relation mappings
endif::ss-ff-stackpacks2_enabled[]

| rbac
| Manage RBAC

| service-token
| Manage service tokens.

| settings
| Manage instance settings and configurations

| stackpack
| Manage and upload StackPacks

| topic
| Manage Kafka topics

| topology-sync
| Manage topology synchronization

| user-session
| Inspect user sessions

| version
| Display version information
|===

ifdef::ss-ff-stackpacks2_enabled[]
{empty}* Experimental commands that require the `STS_EXPERIMENTAL_OTEL_MAPPING=true` environment variable to be enabled.

Example usage:

[,bash]
----
STS_EXPERIMENTAL_OTEL_MAPPING=true sts otel-component-mapping --help
----
endif::ss-ff-stackpacks2_enabled[]

All commands accept the `--help` flag, which documents each command's usage.

For detailed information about any command and its subcommands, run:

[,bash]
----
sts [command] --help
----

== Upgrade

To upgrade to the latest version of the `sts` CLI, <<_quick_start, run the install command again>>.

You can check the version of the `sts` CLI that you are currently running with the command `sts version`.

== Uninstall

[tabs]
====
Windows::
+
--
[discrete]
=== Quick uninstall

Open a *Powershell* terminal and run:

[,powershell]
----
. { iwr -useb https://dl.stackstate.com/stackstate-cli/install.ps1 } | iex; uninstall
----

The `sts` CLI and all associated configuration are now removed for the current user.

[discrete]
=== Manual uninstall

Open a *Powershell* terminal and run each step one-by-one or all at once. The `sts` CLI and all associated configuration will be removed for the current user.

. Remove binary:
+
[,powershell]
----
$CLI_PATH = $env:USERPROFILE+"\stackstate-cli"
rm -R $CLI_PATH 2>1  > $null
----

. Remove config:
+
[,powershell]
----
rm -R $env:USERPROFILE+"\.config\stackstate-cli" 2>1  > $null
----

. Remove the CLI from the environment path:
+
[,powershell]
----
$PATH = (Get-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Environment' -Name PATH).Path
$i = $PATH.IndexOf(";$CLI_PATH")
if ($i -ne -1) {
  $PATH = $PATH.Remove($i, $CLI_PATH.Length+1)
  (Set-ItemProperty -Path 'Registry::HKEY_CURRENT_USER\Environment' -Name PATH –Value $PATH)
}
----
--

macOS::
+
--
[discrete]
=== Quick uninstall

Open a terminal and run:

[,bash]
----
curl -o- https://dl.stackstate.com/stackstate-cli/uninstall.sh | bash
----

The `sts` CLI and all associated configuration are now removed for the current user.

[discrete]
=== Manual uninstall

. Open a terminal.
. To remove the `sts` CLI, run the command:
+
[,bash]
----
rm -r /usr/local/bin/sts
----

. To remove configuration for the `sts` CLI, run the command:
+
[,bash]
----
rm -r ~/.config/stackstate-cli
----

The `sts` CLI and all associated configuration are now removed for the current user.
--

Linux::
+
--
[discrete]
=== Quick uninstall

Open a terminal and run:

[,bash]
----
curl -o- https://dl.stackstate.com/stackstate-cli/uninstall.sh | bash
----

The `sts` CLI and all associated configuration are now removed for the current user.

[discrete]
=== Manual uninstall

. Open a terminal.
. To remove the `sts` CLI, run the command:
+
[,bash]
----
rm -r /usr/local/bin/sts
----

. To remove configuration for the `sts` CLI, run the command:
+
[,bash]
----
rm -r ~/.config/stackstate-cli
----

The `sts` CLI and all associated configuration are now removed for the current user.
--

Docker::
+
--
To remove the CLI image and containers run:

[,bash]
----
docker rmi -f stackstate/stackstate-cli2
----
--
====

== Open source

The {stackstate-product-name} `sts` CLI is open source and can be found on GitHub at:

* https://github.com/stackvista/stackstate-cli
