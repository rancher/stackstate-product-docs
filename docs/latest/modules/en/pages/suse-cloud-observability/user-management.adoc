// This file is included in suse-cloud-observability-user-management.adoc
// Do not add a title here as it will be provided by the parent document

Users of the SUSE Cloud Observability tenants (StackState instances) are managed with https://www.keycloak.org/[Keycloak]. Each customer (tenant) has a dedicated Keycloak realm. A link to the Keycloak console is sent in the welcome message when a user is created.

Users who are members of the `realm-admin` Keycloak group receive a link to the Keycloak Admin Console in the welcome message.

StackState redirects users to Keycloak for authentication. Users are expected to be members of one or more Keycloak groups.

The predefined Keycloak groups:

* *realm-admin*: Members of this group can log in to the Keycloak realm console and perform user management operations.
* *stackstate-k8s-troubleshooter*: Users in this group are assigned the `stackstate-k8s-troubleshooter` Keycloak client role, which maps to the StackState role with the same name. The role grants regular StackState permissions.
* *stackstate-k8s-admin*: Users in this group are assigned the `stackstate-k8s-admin` Keycloak client role, which maps to the StackState role with the same name. The role grants privileged StackState permissions.

= User management URL

When a new user is created, they receive a welcome message containing a link to the Keycloak user management page. This link is exclusively for the tenant administrator, who is the first user by default. The URL format is: `https://<keycloak FQDN>/realms/<your dedicated Keycloak realm>/account`.

= User management

* Log in to Keycloak Admin Console.

image::keycloak_admin_console.png[Keycloak Admin Console]

== Manage users

* In the left-hand menu, select `Users` under the `Manage` section.

=== Adding a new user

To *add a new user* click the `Add user` button. Enter the necessary user information (Username, Email, First Name, Last Name).

* leave `Required users actions` empty.
* add the user to the required groups.
* click `Save`. The welcome message with the sign-up link and the links to the SUSE Cloud Observability tenant, Keycloak Admin and Account consoles are emailed to the user.
* *To activate the account, which includes email confirmation and the password reset, the user must follow the sign-up link.*

image::keycloak_create_user.png[Keycloak Create User]

=== Updating user details

To *edit user details*, select the user by clicking on Username.

* Change the details as needed.
* Set one or more `Required user actions`, for example, to force users to update password or configure one time passwords.
* Press `Save` button when done.

image::keycloak_update_user.png[Keycloak Update User]

=== Deleting a user

To *delete one or more users*, select the required users and press `Delete user` button.

== Group membership

* Log in to the Keycloak Admin Console.
* In the `Groups` section, search for the group you want to manage.
* Click on the group name to open group details and go to the `Members` tab.
* To add a new group member, press the `Add Member` button and select the required users.
* To delete users from the group, select the users from the list, then from the menu that at the same line as the `Add member` button marked as "â‹®", select `Leave group`.
